#!/usr/bin/env bash
# DEPRECATED: proxy-bridge is legacy. Use the unified executable instead.
# Preferred: litebike-proxy (universal :8888) or litebike CLI where applicable.

# Fast-path: forward server/start to litebike-proxy
case "${1:-server}" in
  server|start)
    BIND_IP="${BIND_IP:-0.0.0.0:8888}"
    # Resolve binary (prefer local build, then PATH)
    LB_BIN="${LB_BIN:-$HOME/litebike/target/release/litebike-proxy}"
    command -v litebike-proxy >/dev/null 2>&1 && LB_BIN="litebike-proxy"
    if [ ! -x "$LB_BIN" ]; then
      echo "proxy-bridge deprecated. Build/run: cargo build --release --bin litebike-proxy && ./target/release/litebike-proxy" >&2
      exit 1
    fi
    echo "proxy-bridge is deprecated. Starting unified proxy via: $LB_BIN (BIND_IP=$BIND_IP)" >&2
    exec env BIND_IP="$BIND_IP" "$LB_BIN"
    ;;
  *)
    echo "proxy-bridge is deprecated. Use the unified binary instead:" >&2
    echo "  - Start proxy:   litebike-proxy (env BIND_IP=0.0.0.0:8888)" >&2
    echo "  - SSH deploy:    see DEPLOY.md (SSH co-build + :8888 smoke test)" >&2
    echo "  - System proxy:  see DEPLOY.md (macOS auto-hosting + PAC)" >&2
    exit 1
    ;;
esac